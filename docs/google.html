<!DOCTYPE HTML>
<html>
    <body>
        
        <h2>My First Web Page</h2>
        <p>My First Paragraph.</p>
        <p id="c"></p>
        <p id="d"></p>
        <p id="e"></p>
        <p id="f"></p>
        <p id="g"></p>
        <p id="h"></p>

        <script type="text/javascript">
            
            
            function getParameterByName(name) {
                var match = RegExp('[?&]' + name + '=([^&]*)').exec(window.location.search);
                return match && decodeURIComponent(match[1].replace(/\+/g, ' '));
            }
        
        function requestToken(client_id, redirect_uri, code, scheme) {
            document.getElementById("e").innerHTML = code;
            document.getElementById("d").innerHTML = client_id;
            document.getElementById("c").innerHTML = redirect_uri;
            document.getElementById("f").innerHTML = scheme;
            <!--            $$a({-->
                                <!--                type: 'post',-->
                                <!--                url: 'https://www.googleapis.com/oauth2/v4/token',-->
                                <!--                data: {-->
                                <!--                'client_id': client_id,-->
                                <!--                'redirect_uri': redirect_uri,-->
                                <!--                'grant_type': 'authorization_code',-->
                                <!--                'code': code,-->
                                <!--                'client_secret': 'w-PDKd0Ui2xKZ8OVlDFuihQk'-->
                                <!--                },-->
                                <!--                response: 'text',-->
                                <!--                success: function (data) {-->
                                <!--                $$('result',$$('result').innerHTML+'<br />'+data);-->
                                <!--                var link = scheme + ':/socialnetwork?provider=google&token=' + token + '&data=' + data-->
                                <!--                window.location.replace(link);-->
                                <!--                }-->
                                <!--                });-->
                                
                                var xhr = new XMLHttpRequest();
                                var body = 'client_id=' + client_id + '&redirect_uri=' + redirect_uri + '&grant_type=authorization_code&code=' + code + '&client_secret=w-PDKd0Ui2xKZ8OVlDFuihQk;
                                document.getElementById("g").innerHTML = body;
                                xhr.open("POST", 'https://www.googleapis.com/oauth2/v4/token', true);
                                xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
                                
                                xhr.onreadystatechange = function() {
                                    document.getElementById("h").innerHTML = 'body';
                                };
                                
                                xhr.send(body);
        }
        
        window.onload = function() {
            var identifier = getParameterByName('state');
            var code = getParameterByName('code');
            var client_id = identifier + '.apps.googleusercontent.com';
            var redirect_uri = 'https://iwheelbuy.github.io/SocialNetwork/google.html';
            var scheme = 'com.googleusercontent.apps.' + identifier + ':/';
            
            <!--            document.getElementById("b").innerHTML = identifier;-->
            <!--            document.getElementById("c").innerHTML = code;-->
            <!--            document.getElementById("d").innerHTML = client_id;-->
            <!--            document.getElementById("e").innerHTML = redirect_uri;-->
            <!--            document.getElementById("f").innerHTML = scheme;-->
            
            requestToken(client_id, redirect_uri, code, scheme)
        }
        
            </script>
    </body>
</html>






